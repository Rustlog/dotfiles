### Inner gaps ###
gaps inner 3

### Default Font ###
font pango: SourceCodePro 3

### Bar ###
bar {
    # swaybar_command waybar
}

### Output devices (Display) ###
    set $output         *
    set $output_DP      eDP-1
    set $output_HDMI    HDMI-A-1

    set $output $output

    output $output  background #343434 solid_color
    output $output  mode 1920x1080@144Hz
    output $output  scale 1
    output $output  transform normal
    output $output  scale_filter smart
    output $output  max_render_time off
    output $output  render_bit_depth 8
    output $output  subpixel rgb
    output $output  adaptive_sync on
    output $output  allow_tearing yes
    # output $output  color_profile icc /usr/share/color/icc/colord/sRGB.icc
    output $output  color_profile icc /usr/share/color/icc/colord/Rec709.icc

### Enable Xwayland ##
    xwayland enabled

### Input devices ###

    #* Hide cursor in 1 secs
    seat * {
        hide_cursor 1000
        xcursor_theme breeze_cursors 24
        hide_cursor when-typing enable
        pointer_constraint enable
    }

    #* All Keyboards
    input type:keyboard {
        xkb_layout us,es,ru
        repeat_delay 160
        repeat_rate 60
    }

    #* All Pointer devices
    input type:pointer {
        pointer_accel 1
        scroll_factor 2
        natural_scroll disabled
        dwt enabled
        accel_profile adaptive
    }

    #* All Trackpads
    input type:touchpad {
        pointer_accel 1
        scroll_factor 2
        click_method clickfinger # Clickfinger
        scroll_method two_finger # Scroll method
        drag enabled
        accel_profile adaptive   # trackpad acceleration
        middle_emulation enabled # Enable middle emulation
        drag_lock disabled       # Disable drag lock
        dwt enabled              # disable while typing
        natural_scroll enabled   # Inverted scroll
        tap enabled              # enable taps (should not be disabled)
        tap_button_map lrm       # lrm  ( single finger tap: left click   )
                                 #      ( Two finger tap:    right click  )
                                 #      ( Three finger tap:  middle click )
    }

### Set $mod (Mod4 or Super) for logo key ###
    set $mod Super

### Vim bindings everywhere ###
    set $left h
    set $down j
    set $up k
    set $right l

### My Application launcher ###
    set $menu_wofi wofi \
        -W 40% -H 32% \
        --gtk-dark \
        --allow-images \
        --allow-markup \
        --hide-scroll \
        --prompt="Search" \
        --show drun

    set $menu_rofi rofi \
        -show-icons \
        -font Hack \
        -theme material \
        -show drun

    set $fuzzel fuzzel \
        --background="#333333FA" \
        --text-color="#BBBBBBFF" \
        --width=60 --lines=10 \
        --prompt="Search: "

### Auto Start ###

    # pipewire
    exec pipewire
    # Notification deamon
    exec mako
    # Polkit agent for authorization
    exec /usr/lib/polkit-kde-authentication-agent-1
    # Start waybar
    exec sleep 0.2 && bash ~/.config/sway/scripts/WaybarThemes 1
    # Autotiling
    exec autotiling
    # Playerctl daemon
    exec playerctld
    # Easyeffects
    exec easyeffects --gapplication-service
    # NetworkManager indicator
    exec nm-applet --indicator

    # XDG desktop fixes
    exec /usr/lib/xdg-desktop-portal-wlr &
    exec /usr/lib/xdg-desktop-portal -r

    # GTK Theme
    exec gsettings set org.gnome.desktop.interface gtk-theme Breeze

    # Set default volume, mute mic and brightness
    exec bash -c ' \
        sleep 1; pactl set-sink-volume @DEFAULT_SINK@ 64%; \
        pactl set-sink-mute @DEFAULT_SINK@ false; \
        pactl set-source-volume @DEFAULT_SOURCE@ 0%; \
        pactl set-source-mute @DEFAULT_SOURCE@ true; \
        brightnessctl set 24% \
    '

    exec swayidle -w \
            timeout 100 "${HOME}/.config/sway/lock_screen/lock.sh" \
            resume "swaymsg 'output * power on'" \
            before-sleep "${HOME}/.config/sway/lock_screen/lock.sh set_bg"

    # Start foot server
    exec_always bash -c ' \
        sock="${XDG_RUNTIME_DIR}/foot${WAYLAND_DISPLAY/#/-}.sock"; \
        [[ -S "${sock}" ]] && exit 0; \
        foot --server=${sock} & \
    '

### Window rules ###
    # Set opacity
        set $vulkan 0.985
        set $opengl 0.885

        for_window [app_id=".*"] opacity $vulkan
    # Border of newly spawned window
        for_window [class=".*"] border pixel 1
    # Border of floating window
        for_window [class=".*"] default_floating_border pixel 1
    # Transparancy levels for applications
        for_window [app_id="^foot$"] opacity 0.97
        for_window [app_id="waterfox*|vivaldi*|Alacritty*|mpv*|imv*|org.pulseaudio.*"] opacity 1
        for_window [app_id="^(journal|solid|solid_f|org.qutebrowser.qutebrowser)$"] opacity 1
        for_window [class="Opera*|feh*|guvcview*|qutebrowser"] opacity 1
    # Float Any App which has Id = 'Floating|Float|floating'
        for_window [app_id="^(Floating|Float|solid_f|floating|float)$"] floating enable, move position center
    # Enable floating (don't tile when launched)
        for_window [app_id="^(com.rtosta.zapzap|org.pulseaudio.pavucontrol)$"] floating enable
        for_window [app_id="^(nm-connection-editor)$"] floating enable
        for_window [app_id="^(pavucontrol|com.github.wwmm.easyeffects)$|waterfox*|vivaldi*"] floating enable
        for_window [app_id="^(org.kde.dolphin|org.kde.plasma-systemmonitor)$"] floating enable
        for_window [app_id="^(blueman-manager|org.kde.konsole)$"] floating enable
        for_window [app_id="^(org.kde.okular|org.qutebrowser.qutebrowser|org.kde.kclock$)$"] floating enable
        for_window [class="^(Brave-browser|ZapZap|discord|qutebrowser)$"] floating enable
        for_window [app_id="^blender*|org.gnome.Nautilus"] floating enable

    # <outer-border-color> <frame-color> <title-text-color> <next-tiling-indicator-color>
        client.focused   #333333 #6600AA #DDDDDD #6600AA
        client.unfocused #333333 #666666 #DDDDDD #666666

### Window Styling ###
    # Thickness of the titlebar border in pixels
        titlebar_border_thickness 0
    # Padding of the text in the titlebar
        titlebar_padding 0
    # Align titlebar text
        title_align center
    # Default border
        default_border none
    # Hide the titlebar on stacked or tabbed containers with one child
        hide_edge_borders --i3 none

### Keybindings for Containers/Workspaces/Gestures/Layout/Behaviour/Volume/Brightnes/Focus ###

    #* Reload the configuration file
        bindsym $mod+Shift+C exec swaymsg reload && exec bash ~/.config/sway/scripts/WaybarThemes 1

    #* Exit sway (Kicks you out of your Wayland session) *#
        bindsym $mod+Shift+E exec swaymsg exit

    #* Rotate Display clockwise *
        bindsym Alt+Tab exec bash -c ' \
                current="$(swaymsg --raw --type get_outputs | jq -r \".[].transform\")"; \
                [[ "${current}" == "normal" ]] && current=0; \
                [[ "${current}" == "270" ]] && current=0 || current=$(( current + 90 )); \
                swaymsg output "*" transform "${current}" \
        '
    #* Rotate Display counter-clockwise *
        bindsym Alt+Shift+Tab exec bash -c ' \
                current="$(swaymsg --raw --type get_outputs | jq -r \".[].transform\")"; \
                [[ "${current}" == "normal" ]] && current=0; \
                [[ "${current}" == "0" ]] && current=270 || current=$(( current - 90 )); \
                swaymsg output "*" transform "${current}" \
        '
    #* Reset Display to default view (horizontal) *
        bindsym $mod+0 exec swaymsg output '*' transform 0

    #* Toggle keyboard layout *#
        bindsym $mod+Alt+space input type:keyboard xkb_switch_layout next

    #* Mouse for dragging *#
        floating_modifier $mod normal

    #* Switch to workspace *#
        bindsym {
            $mod+1 workspace number 1
            $mod+2 workspace number 2
            $mod+3 workspace number 3
            $mod+4 workspace number 4
            $mod+5 workspace number 5
            $mod+6 workspace number 6
        }

    #* Cycle next workspace *#
        # Focus the next window (one-directional)
        bindsym $mod+Tab exec bash -c ' \
            swaymsg focus right || \
            swaymsg focus down  || \
            swaymsg focus up    || \
            swaymsg focus left  || \
            swaymsg workspace next \
        '
        # Focus the previous window (one-directional)
        bindsym $mod+Shift+Tab exec bash -c ' \
            swaymsg focus left  || \
            swaymsg focus up    || \
            swaymsg focus down  || \
            swaymsg focus right || \
            swaymsg workspace prev \
        '


    #* Move focused container to workspace *#
        bindsym {
            $mod+Shift+1 move container to workspace number 1
            $mod+Shift+2 move container to workspace number 2
            $mod+Shift+3 move container to workspace number 3
            $mod+Shift+4 move container to workspace number 4
            $mod+Shift+5 move container to workspace number 5
            $mod+Shift+6 move container to workspace number 6
        }

    #* Special keys to adjust volume via PulseAudio *#
        bindsym {
            XF86AudioMute        exec pactl set-sink-mute @DEFAULT_SINK@ toggle
            XF86AudioMicMute     exec pactl set-source-mute @DEFAULT_SOURCE@ toggle
            XF86AudioLowerVolume exec pactl set-sink-volume @DEFAULT_SINK@ -5%
            XF86AudioRaiseVolume exec pactl set-sink-volume @DEFAULT_SINK@ +5%
            XF86AudioPrev        exec playerctl previous
            XF86AudioPause       exec playerctl pause-pause
            XF86AudioNext        exec playerctl next
        }

    #* Special keys to adjust brightness via brightnessctl *#
        bindsym {
            XF86MonBrightnessDown exec brightnessctl set 5%-
            XF86MonBrightnessUp   exec brightnessctl set 5%+
        }

    # Audio-Video controls (playerctl)
        # Play-pause
            bindsym $mod+Up   exec playerctl play-pause

        # Mute sink (output)
            bindsym $mod+Down exec pactl set-sink-mute @DEFAULT_SINK@ toggle

        # Seek backward
            bindsym $mod+Ctrl+Left  exec playerctl position $( awk '{ print $1 - (5)  }' <<< $(playerctl position) )
            bindsym $mod+Left       exec playerctl position $( awk '{ print $1 - (10) }' <<< $(playerctl position) )
            bindsym $mod+Shift+Left exec playerctl position $( awk '{ print $1 - (40) }' <<< $(playerctl position) )

        # Seek forward
            bindsym $mod+Ctrl+Right  exec playerctl position $( awk '{ print $1 + (5)  }' <<< $(playerctl position) )
            bindsym $mod+Right       exec playerctl position $( awk '{ print $1 + (10) }' <<< $(playerctl position) )
            bindsym $mod+Shift+Right exec playerctl position $( awk '{ print $1 + (40) }' <<< $(playerctl position) )

        # Volume controls
            # Volume up
            bindsym $mod+Ctrl+Up   exec playerctl volume $( awk '{ print $1 + 1/20 }' <<< $(playerctl volume) )
            # Volume down
            bindsym $mod+Ctrl+Down exec playerctl volume $( awk '{ print $1 - 1/20 }' <<< $(playerctl volume) )

        # Play previous
            bindsym $mod+Shift+Up exec playerctl previous

        # Play next
            bindsym $mod+Shift+Down exec playerctl next

    #* Gestures in sway *#

    # bindgesture swipe:3:right exec bash -c " \
    #     swaymsg workspace \
    #     $(( $(swaymsg --raw --type get_workspaces | jq -r '.[] | select(.focused).name') - 1 )) \
    # "
    # bindgesture swipe:3:left exec bash -c " \
    #     swaymsg workspace \
    #     $(( $(swaymsg --raw --type get_workspaces | jq -r '.[] | select(.focused).name') + 1 )) \
    # "

    bindgesture swipe:3:up floating enable
    bindgesture swipe:3:down floating disable

    bindgesture swipe:4:up move scratchpad
    bindgesture swipe:4:down scratchpad show

    bindgesture pinch:3:inward exec bash -c ' \
        swaymsg resize shrink height 20; \
        swaymsg resize shrink width 20 \
    '
    bindgesture pinch:3:outward exec bash -c ' \
        swaymsg resize grow height 20; \
        swaymsg resize grow width 20 \
    '

    #* Move your focus around, mode: VIM (hjkl) *#
        bindsym {
            $mod+$left  focus left
            $mod+$down  focus down
            $mod+$up    focus up
            $mod+$right focus right
        }

    #* Move the focused window in floating mode, modes: VIM (hjkl) or arrow keys *#
        bindsym {
            $mod+Shift+$left    move left
            $mod+Shift+$right   move right
            $mod+Shift+$up      move up
            $mod+Shift+$down    move down
            # $mod+Shift+Left move left
            # $mod+Shift+Right move right
            # $mod+Shift+Up move up
            # $mod+Shift+Down move down
        }

    #* Resizing containers *#
        bindsym $mod+r mode resize
        mode resize {
            bindsym $left   resize shrink width 14px
            bindsym $right  resize grow width 14px
            bindsym $up     resize shrink height 14px
            bindsym $down   resize grow height 14px

            bindsym Return mode default
            bindsym Escape mode default
        }

        bindsym {
            $mod+Ctrl+$left     resize shrink width 14px
            $mod+Ctrl+$right    resize grow width 14px
            $mod+Ctrl+$up       resize shrink height 14px
            $mod+Ctrl+$down     resize grow height 14px
        }

    #* Layout stuff *#
        # Initial layout in a new an empty workspace
            workspace_layout default
        # Switch the current container between different layout styles
            bindsym $mod+S layout stacking
            bindsym $mod+T layout tabbed
        # decide the spawn side of the new window
        # bindsym $mod+B split horizontal
        # bindsym $mod+V split vertical

        # Toggle btween splith and splitv
            bindsym $mod+V split toggle
        # toggle split mode (Stacking, tabbed, and last split layout)
            bindsym $mod+B layout toggle split
        # Pop the stacking window from the container
            bindsym $mod+N split none
        # Fullscreen!
            bindsym $mod+F fullscreen
        # Jump the focus between tiling and floating mode
            bindsym $mod+Shift+Space floating toggle
        # Swap focus between the tiling area and the floating area
            bindsym $mod+Space focus mode_toggle
        # Move focus to the parent container
            bindsym $mod+A focus parent

        ## Scratchpad:
        # Sway has a "scratchpad", which is a bag of holding for windows.
        # Move the focused window into scratchpad because It's deamon
            bindsym $mod+Shift+minus move scratchpad
        # Cycle through the windows inside scratchpad.
            bindsym $mod+minus scratchpad show


### My Custom Key-bindings ###

    #* Executable Binaries *#
        # Keyboard centric browser
            bindsym $mod+F1 exec \
                env QT_QPA_PLATFORM=wayland qutebrowser
        # Browser 1
            bindsym $mod+F2 exec find ~/.bin/ -name Browser -exec {} 2 ";"
        # Browser 2
            bindsym $mod+F3 exec find ~/.bin/ -name Browser -exec {} 3  ";"
        # Browser 4
            bindsym $mod+F4 exec find ~/.bin/ -name Browser -exec {} 4  ";"
        # Browser 5
            bindsym $mod+F5 exec find ~/.bin/ -name Browser -exec {} 5  ";"

        # Bring my Text-fu terminal
            bindsym $mod+Return exec footclient
            bindsym Alt+Return exec footclient --app-id=solid
            bindsym $mod+Shift+Return exec alacritty

        # File Managers
            bindsym Alt+E exec \
                env XDG_CURRENT_DESKTOP=kde QT_QPA_PLATFORMTHEME=qt6ct dolphin
            bindsym $mod+E exec nautilus
        # Lauch application launcher
            bindsym Alt+Space exec $fuzzel
            bindsym Alt+Shift+Space exec $menu_rofi
        # Lauch fuzzel
            bindsym $mod+D exec $menu_wofi

    #* Kill the focused windows *#
        bindsym $mod+q kill
        bindsym Alt+F4 kill

    #* Direct Shell Commands *#
        #$ Screen Recording $#
            # Start recording fullscreen! (Mod+Alt+V)
                bindsym $mod+Alt+V exec bash -c ' \
                    DIR="${HOME}/media/WF_Recorder"; \
                    if [[ ! -d "${DIR}" ]]; then \
                        mkdir -p "${DIR}"; pidof wf-recorder &> /dev/null; \
                    else \
                        declare -a flags; \
                        flags=( \
                            "--pixel-format=yuv420p" \
                            "--framerate=60" \
                            "--audio=$(pactl get-default-sink).monitor" \
                            "--file=${DIR}/Rec_$(date +%d-%b-%Y_%H:%M:%S).mkv" \
                        ); \
                    fi; \
                    notify-send -t 1000 "Screen recording started (fullscreen)"; \
                    if ! wf-recorder "${flags[@]}" --codec=h264_nvenc -p preset=fast; then \
                        wf-recorder "${flags[@]}" --codec=libx264 -p preset=ultrafast; \
                    fi \
                ' &>> '/tmp/sway_fullscreen_recording.log'

            # Start recording on selected ratio of the screen (Mod+Shift+V)
                bindsym $mod+Shift+V exec bash -c ' \
                    DIR="${HOME}/media/WF_Recorder"; \
                    if [[ ! -d "${DIR}" ]]; then \
                        mkdir -p "${DIR}"; pidof wf-recorder &> /dev/null; \
                    else \
                        declare -a flags; \
                        flags=( \
                            "--pixel-format=yuv420p" \
                            "--framerate=60" \
                            "--audio=$(pactl get-default-sink).monitor" \
                            "--geometry=$(slurp -b=aaccbb11)" \
                            "--file=${DIR}/Rec_$(date +%d-%b-%Y_%H:%M:%S).mkv" \
                        ); \
                    fi; \
                    notify-send -t 1000 "Screen recording started (${flags[3]##*=})"; \
                    if ! wf-recorder "${flags[@]}" --codec=h264_nvenc -p preset=fast; then \
                        wf-recorder "${flags[@]}" --codec=libx264 -p preset=ultrafast; \
                    fi \
                ' &>> '/tmp/sway_selected_screen_recording.log'

            # Stop recording send INT sig to the recorder (Mod+Alt+C)
                bindsym $mod+Alt+C exec bash -c ' \
                    notify-send -t 3000 "Recording Stopped"; \
                    kill -INT $(pidof wf-recorder) \
                '

        #$ Screenshot $#
            # Take screenshot of fullscreen! (Mod+PrtSc)
                bindsym $mod+Print exec bash -c ' \
                   DIR="${HOME}/media/Grim_Screenshots"; \
                   [[ -d "${DIR}" ]] || mkdir -p "${DIR}"; \
                   grim "${DIR}/$(date +%d-%b-%Y_%T).png" \
                '
            # Screenshot of selected area (Mod+Shift+S)
                bindsym $mod+Shift+S exec bash -c ' \
                    DIR="${HOME}/media/Grim_Screenshots"; \
                    [[ -d "${DIR}" ]] || mkdir -p "${DIR}"; \
                    grim -g "$(slurp -b=aaccbb11)" "${DIR}/$(date +%d-%b-%Y_%T).png" \
                '

        # Edit this (sway config) with neovim or vim
            bindsym $mod+I exec foot --app-id=solid bash -c ' \
                conf=${HOME}/.config/sway/config; \
                nvim ${conf} \
            '

        # Shutdown (Mod+Alt+Shift+P)
            bindsym $mod+Alt+Shift+P exec bash -c ' \
                notify-send "Shutting down...!"; \
                sleep 2 && systemctl poweroff --now || loginctl poweroff \
            '
        # Reboot/Restart ($mod+Alt+Shift+R)
            bindsym $mod+Alt+Shift+R exec bash -c ' \
                notify-send "REBOOTING...!"; \
                sleep 2 && systemctl reboot --now  || loginctl reboot \
            '
        # Sleep (Mod+Alt+Shift+delete)
            bindsym $mod+Alt+Shift+delete exec bash -c ' \
                notify-send "I need some Rest"; \
                sleep 2 && systemctl suspend --now || loginctl suspend \
            '

        # Shutdown  ($mod+Alt+P)
            bindsym $mod+Alt+P      exec systemctl poweroff --now || loginctl poweroff

        # Reboot/Restart (Mod+Alt+R)
            bindsym $mod+Alt+R      exec systemctl reboot --now || loginctl reboot
        # Sleep (Alt+Ctrl+delete)
            bindsym $mod+Alt+delete exec systemctl suspend --now || loginctl suspend

        # Hybrid sleep, like sleep but cooler (Mod+Alt+S)
            bindsym $mod+Alt+S      exec systemctl hybrid-sleep --now

        # What's my selected screen resolution? (Mod+Shift+G)
            bindsym $mod+Shift+G  exec bash -c ' \
                res="$(slurp -b aaccbb11)"; \
                notify-send -t 8000 "${res}"; \
                wl-copy "${res}"\
            '

        # List of Emojies in rofi-emoji (Mod+backslash+E)
            bindsym $mod+grave+V exec rofi -modi emoji -show emoji

        # Select and set wallaper
        bindsym $mod+W+Space exec foot --app-id=floating -w 1200x600 bash -c ' \
            dir="${HOME}/.local/share/wallpapers"; \
            cd "${dir}"; \
            selected="$(fzf --preview-window right:80% --preview="chafa --size=60x30 --animate=off {}")"; \
            swww img "${dir}/${selected}" --transition-type fade --transition-duration 1; \
        '

        # Temporary thought dumping
            bindsym $mod+grave+T exec foot bash -c ' \
                temp_edit_file="$(mktemp -t temp_edit.XXXX)"; \
                trap "rm -f \${temp_edit_file}" EXIT SIGKILL SIGINT; \
                command -v nvim &> /dev/null && EDITOR="nvim"; \
                ${EDITOR:-vim} "${temp_edit_file}"; wl-copy < "${temp_edit_file}"; \
                rm -f "${temp_edit_file}" \
            '

    #* System monitors *#
        # htop
        bindsym Ctrl+Shift+Escape exec foot bash -c ' \
            htop || btop \
        '

        # btop
        bindsym Ctrl+Escape exec foot bash -c ' \
            btop || htop \
        '

        # Plasma system monitor
        bindsym $mod+Escape exec bash -c ' \
            if ! env XDG_CURRENT_DESKTOP=KDE \
                GTK_THEME=Adwaita:dark \
                plasma-systemmonitor; then \
                foot htop || sudo pacman -Sy htop --noconfirm \
            fi \
        '

    #* Scripts *#
        # Waybar
            # Reload current theme
            bindsym Ctrl+F10 exec pkill -SIGUSR2 -f "WaybarThemes 1"
            # toggle Next theme
            bindsym Shift+F10 exec pkill -SIGUSR1 -f "WaybarThemes 1"
            # Kill waybar
            bindsym Ctrl+Shift+F10 exec pkill -SIGTERM -f "WaybarThemes 1|waybar -c"

        # Create cava windows to look cool
            bindsym $mod+P exec $(find ~/.bin/ -type f -name CavaInstances)
            bindsym $mod+O exec $(find ~/.bin/ -type f -name CavaInstances) clean

        # Journal time
            bindsym $mod+grave+J exec foot --app-id=journal bash -c ' \
                command -v nvim &> /dev/null && export EDITOR=${EDITOR:-nvim}; \
                ${HOME}/.bin/main/JournalToday edit \
            '


### Additional configuration
include /etc/sway/config.d/*
# Documentation `man 5 sway`

